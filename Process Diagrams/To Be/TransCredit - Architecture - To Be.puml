@startuml
title TransCredit New System Architecture - Desired State

package "PlateauGroup.Web Solution" {
  
  package "Frontend (Blazor)" {
    [CertificateSearch.razor] as CertSearch
    note top of CertSearch
      Enhanced Search Parameters:
      - First/Last Name (wildcards)
      - Birthday
      - SSN
      - Claim Number
    end note
    
    [CertificateDetails.razor] as CertDetails
    [AgentReportPage.razor] as AgentReport
    note bottom of AgentReport
      Communication Tab:
      - View all communications
      - Send additional emails
      - Track resolution status
    end note
    
    [CertAudit.razor] as CertAudit
    note top of CertAudit
      Collapsible Component:
      - Shows certificate audit logs
      - Change history display
    end note
  }
  
  package "Backend Services" {
    [CertificateService.cs] as CertService
    note right of CertService
      Core Functions:
      - Certificate CRUD operations
      - Enhanced search logic
      - Audit logging
      - CurrentRYM validation
    end note
    
    [AgentCommunicationService.cs] as AgentComm
    note left of AgentComm
      Communication Features:
      - Email generation/sending
      - Response parsing
      - DMZ data copying
      - Attachment handling
    end note
    
    [ReportBalancingService.cs] as BalanceService
    note right of BalanceService
      Balancing Process:
      - Report vs Remittance
      - Certificate validation
      - Financial reconciliation
    end note
    
    [ErrorCheckingService.cs] as ErrorService
    note left of ErrorService
      Error Validation:
      - Access/SQL code review
      - Certificate validation
      - Agent limit verification
    end note
  }
  
  package "Database Tables" {
    [CertMaster] as CertMaster
    [CertAudit] as CertAuditTable
    note top of CertAuditTable
      Audit Fields:
      - CertId, ChangedValue
      - OldValue, NewValue
      - Reason, ChangeDate
      - ChangedBy
    end note
    
    [AgentReportEmail] as AgentEmail
    note bottom of AgentEmail
      Email Tracking:
      - AgentReportId
      - Email content
      - Resolution status
      - Inbound/Outbound flag
    end note
    
    [AgentReportEmailAttachment] as EmailAttach
    note top of EmailAttach
      Attachment Storage:
      - FileName, FileData
      - Linked to AgentReportEmail
    end note
    
    [CertError] as CertError
    [CompanyMaster] as CompanyMaster
    note right of CompanyMaster
      RYM Constraint:
      Can only edit certificates
      in current RYM
    end note
  }
}

package "DMZ Website" {
  [DMZ.Web] as DMZWeb
  note left of DMZWeb
    Agent Portal Features:
    - View pending reports
    - Edit certificates
    - Submit corrections
    - Secure authentication
  end note
  
  [DMZ MS SQL Server] as DMZDB
  note right of DMZDB
    Temporary Storage:
    - Certificate copies
    - Agent report data
    - Deleted after completion
  end note
  
  [Auth0 MFA] as Auth0
}

package "External Systems" {
  [Email System] as EmailSys
  note bottom of EmailSys
    Email Features:
    - Send/receive emails
    - Parse AgentReportEmail IDs
    - Forward unresolved emails
  end note
  
  [Agent Platforms] as AgentPlatforms
}

' Certificate Search Flow
CertSearch --> CertService : "Enhanced Search"

' Certificate Audit Flow
CertService --> CertAuditTable : "Log Changes"
CertDetails --> CertAudit : "Show Audit Log"
CertAudit --> CertAuditTable : "Display History"

' Error Checking Flow
ErrorService --> CertError : "Store Errors"
CertService --> ErrorService : "Validate Certificates"

' Agent Communication Flow
AgentReport --> AgentComm : "Send Email"
AgentComm --> AgentEmail : "Store Outbound"
AgentComm --> AgentEmail : "Store Inbound"
AgentComm --> EmailAttach : "Store Attachments"
AgentComm --> EmailSys : "Send to Agent"
EmailSys --> AgentComm : "Receive Response"

' DMZ Integration Flow
AgentComm --> DMZWeb : "Copy to DMZ"
DMZWeb --> Auth0 : "Agent Authentication"
DMZWeb --> DMZDB : "Store Certificates"
DMZDB --> CertMaster : "Sync Changes"

' Balancing Flow
BalanceService --> CertMaster : "Balance Report"
BalanceService --> AgentReport : "Update Remittance"

' Company Master Flow
CertService --> CompanyMaster : "Check CurrentRYM"

' Agent Report Communication
AgentReport --> AgentEmail : "View Communications"

@enduml
